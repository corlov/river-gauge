На 28.11.2025
    Работает устройство
    Пин Ресет модема вытащить

    !!! В редакторе компоненты датчика напряжения - проверить, АЦП перерисовать гребенкой т.к. он кажется не подходит

3 минуты    50 кОм
8 минут     98 кОм
15 минут    180 кОм
19 минут    300 кОм
25 минут    470 кОм
            680
53 минуты   1000


На 27.11.2025
    1) работает основная часть - включение, выключение по аппаратному таймеру, отправка данных в Центр

    2) получается считать данные по всем i2c датчикам

    3) запитал от 3.3В датчик DS18B20, его без адаптера можно подключить к устройству (отслаось проверить как будет показывать при увеличении длины кабеля до      метров), если не получится то передавать или через ковертер уровней или резистор поставить сброс на 3.3В?

    Эксперименты:
        1) датчик напряжения тока питающийся по i2c, подключить е ЕСП32
        2) АЦП внешний - будет ли работать оп нему получение данных с датчика уровня?
        Если так то не нужен конвертер уровней и Нано, обходимся только АЦП
    
    






Итого по схеме:
    научиться считывать сигнал с датчика температуры воды - тогда можно отказаться от Нано
    добавить транзисторый ключ чтобы управлять датчиком уровня жидкости - ? нужно ли  если будет АЦП
    добавить конвертер уровней для обмена между есп и Нано
    добавить Внещний АЦП / Нано

На 26.11.2025:
    1) получение данных с аналоговых датчиков работает только с ПроМикро

    2) есть общение по и2ц между промикро и есп32

    3) при соединении есп и промикро показания с аналоговых датчиков пропадают

    4) при подсоединении делителя напряжения провод питания от 12В стал сильно греться, а при подключении
        только сборки промикро и датчики в итоге сгорел промикро, хотя до этого отдельно эта сборка работала
        но точность напряждения всегда была плохой

    5) принято решение напряжение измеррять через отдельный модуль

    6) цифровой датчик температуры воды также через модуль отдельный только выдает показания точные - используем с модулем

    7) самый не ясный вопрос - почему промикро с датчиками отдельности работает и получает с них показания.
        как только соединяю с общей сборкой и2ц работает получаю показания с цифрового датчика но датчики аналоговый от 12В перестают давать показания

    8) в прошивке нужно продумать так чтобы из Центра получать информацию и применять ее

    
================================================================================================================

параметры которые следует отдавать в ответе с сервера на устройство:

1) точное время (если датчик точного времени ушел куда то его скорректировать)
2) подстроечные параметры резисторов
Опционально:
1) частота выхода тна связь
2) дельту перепада уровня которую считать сигналом тогочто посылки надо учащенно отправлять на сервер

Продумать (составить список) всех остальных настроечных величин и признаков которые было бы важно менять удаленно
================================================================================================================



По устройству:
    1) распечатать плату
        плата должна пройти все проверки
        увеличить толщины дорожек питания
        залить все слои максимально земляным экраном

    3) собрать все устройство

Следующий этап:

    5) отправить плату на Завод на изготовление

    5) продумать герморазъемы как сделать лучше

Локально:
    1) внести изменения  в проект схемы
        пока ножки куда что подлключено в схеме не учтены

    2) осталось подключение двух датчиков:
        температура воды
        уровень воды

        Перед подключением к Ардуино обязательно нужно проверить напряжения - чтобы они не сожгли датчик



Краткое резюме:
    На схеме в чертеже:
        1) подтягивающий резистор 5 кОм от датчика температуры воды к +5В присоединить
        2) поправить соединение пинов к ЕСП
        3) добавить про микро на схему
    По сборке:
        собрать получение данных от сенсоров на Про микро и скорее всего нужен преобразователь уровней 3 - 5 В
        сделать стык с ЕСП
        протестировать все в сборе
        Датчик температуры тестировать отдельно


------------------------------------------------------------------------------------------------    
    
/home/kostya/SillyTavern/data/default-user/chats/default_Assistant/Assistant - 2025-10-18@11h02m10s.jsonl


1) заменить ESP32 на ардуино нано или еще что то с низким энергопотреблением
    режим сна теперь не нужен
    интерфейсы:
        i2c
        tx, rx - модем
        цифровые выходы - минимум 8 штук, лучше 12
        

------------------------------------------------------------------------------------------------
1) Реализовать схему с отключением общего питания по таймеру
При этом раз в полчаса питание должно подаваться
Ардуина быстропроеверяет была ли успешной отправка данных в центр предыдущая, если была, то отключаемся
Либо что с момента последнего отправления прошло более 8 часов, т.е. это 16 запуск.
Если запусков было более 16 и отправка не удалась то каждый раз пытаемся отправить.

2) Реализовать схему с подключением питания модуля связи и датчика уровня

3) как определять уровень заряда АКБ?
    "Уровень заряда АКБ через Делитель логически отключаемый.jsonl"
    Уровень заряда напрямую связан с напряжением.
    Через делитель нарпяжения получать на аналоговый вход арудины значения с + клеммы
    Делитель подключать только через Мофсет иначе будет утекать постоянно ток с делителя


Шаги:
    1) аппаратная схема общего откл. питания
    2) датчик давления
    3) усоверш. схема питания (отключение модуля связи и датчика)
    4) схема делителя напряжения
    5) сбор в корпусе


------------------------------------------------------------------------------------------------





Открытые вопросы:
    1) поскольку устройство в основном будет спать и включаться заведется ли оно на морозе? Не все компоненты точно климатические
        Возможно его придется ставить непосредственно весной перед паводками
    2) будет ли вытягивать 2Ж связь, по зоне покрытия - да, хотя якобы 3ж и 4ж вытесняют 2ж но пок атре покрытия это не  так - делаем ставку на 2ж
    4) адекватность работы датчика глубины




# Советы от ИИ

## Подключить SIM800L

Питание: ВАЖНО! Не питай SIM800L от пина 3.3V или 5V на ESP32. Ему нужен ток до 2А в пике. Используй отдельный Li-Po аккумулятор или понижающий DC-DC преобразователь, подключенный к источнику питания.
Управление питанием: Пин, который ты выбрал для управления транзистором (например, GPIO4), подключай к базе транзистора.
Serial (UART):
ESP32 TX (например, GPIO17) -> SIM800L RX
ESP32 RX (например, GPIO16) -> SIM800L TX
Не забудь соединить земли (GND) ESP32 и источника питания SIM800L.


https://microkontroller.ru/esp32-projects/podklyuchenie-gsm-modulya-sim800l-k-esp32/


## Связь

Используйте 4G/LTE модуль, например, SIM7600 или A7670.
Почему это лучше:
Покрытие: Сети 4G (LTE) имеют гораздо лучшее покрытие и проникновение сигнала, особенно в сельской местности.
Надежность: Модуль сможет работать в сетях 4G, а если их нет — переключится на 3G или 2G. Это дает максимальный шанс оставаться на связи.
Будущее: Сети 4G будут работать еще очень долго.
Да, эти модули дороже, но для ответственной задачи, где важна надежность связи, экономить на модуле не стоит. К ним так же нужно будет подключать хорошую внешнюю LTE-антенну.




## Герметизация датчика и передача сигнала от датчика на микроконтроллер


Способ: Профессиональный (с герметизацией датчика)
Этот способ предполагает погружение самого датчика в воду, но в специальной защите.

Берем герметичный корпус (опять же, коробка IP67/IP68 или отрезок сантехнической трубы с заглушками).
В стенке корпуса сверлим отверстие чуть больше диаметра металлической части датчика MS5837.
Монтируем плату внутри корпуса так, чтобы металлическая часть датчика "смотрела" наружу через это отверстие.
Тщательно герметизируем зазор между корпусом и металлической частью датчика. Для этого идеально подходит двухкомпонентный эпоксидный клей или хороший морской герметик. Это самый ответственный этап! Нужно убедиться, что вода никак не сможет попасть внутрь.
Выводим провода из корпуса. Для этого используем специальный гермоввод (кабельный сальник). Он зажимает кабель резиновым уплотнителем и не дает воде попасть внутрь.
Всю конструкцию погружаем на дно.
Плюсы:
Максимальная точность измерений, так как датчик находится непосредственно в измеряемой среде.
Более компактное решение.
Минусы:
Сложнее в изготовлении.
Есть риск протечки, если герметизация выполнена некачественно.
Что еще нужно учесть:
Длина кабеля: Интерфейс I2C, по которому работает датчик, не любит длинные провода. Если расстояние от датчика до вашего микроконтроллера больше 1-2 метров, могут начаться проблемы со связью. Решения: использовать специальные расширители I2C (например, на P82B715) или разместить микроконтроллер (например, маленький Arduino Pro Mini или ESP8266) прямо в герметичном корпусе рядом с датчиком, а от него уже передавать данные на "базу" по более дальнобойному интерфейсу (RS-485, LoRa, Wi-Fi).
Калибровка: Перед погружением обязательно измерьте давление на воздухе. Это будет ваше "нулевое" значение (атмосферное давление). Глубина будет рассчитываться из разницы между давлением на дне и этим атмосферным давлением.
